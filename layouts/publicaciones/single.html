{{/* ================================================================ Plantilla
Definitiva para una Publicación Individual Versión: 1.1 Propósito: Mostrar una
publicación académica cargando sus datos desde un archivo .yaml.
================================================================ */}} {{ define
"main" }}
<article class="prose max-w-none dark:prose-invert">
  {{/* PASO 1: Cargar los datos de la publicación desde el archivo .yaml */}} {{
  $dataFile := .Params.datafile }} {{ $pub := "" }} {{ if $dataFile }} {{ $pub =
  index .Site.Data (replace $dataFile ".yaml" "") }} {{ else }}
  <p class="text-red-500 font-bold">
    Error: No se ha especificado un 'datafile' en el archivo .md de esta
    publicación.
  </p>
  {{ end }} {{ if $pub }} {{/* PASO 2: Mostrar el título y la información
  bibliográfica. */}}
  <h1 class="text-3xl font-bold mb-4">{{ $pub.title }}</h1>

  <div class="mb-6 text-slate-600 dark:text-slate-400">
    {{ with $pub.journal }}
    <span><strong>{{ T "published_in" }}:</strong> {{ . }}</span>
    {{ end }} {{ with $pub.year }}
    <span>, {{ . }}</span>
    {{ end }} {{ with $pub.doi }}
    <br />
    <span
      ><strong>DOI:</strong>
      <a
        href="https://doi.org/{{ . }}"
        target="_blank"
        rel="noopener noreferrer"
        class="font-mono hover:underline"
        >{{ . }}</a
      ></span
    >
    {{ end }}
  </div>

  {{/* PASO 3: Lógica para mostrar la lista de autores (CORREGIDA). */}} {{ if
  $pub.all_authors }}
  <div class="mb-6">
    <h2 class="text-xl font-semibold mb-2">{{ T "authors" }}</h2>
    <p>
      {{ $memberPages := slice }} {{ with $pub.members }} {{ range . }} {{
      $memberPage := site.GetPage (printf "members/%s" .) }} {{ if $memberPage
      }} {{ $memberPages = $memberPages | append $memberPage }} {{ end }} {{ end
      }} {{ end }} {{ range $index, $authorName := $pub.all_authors }} {{
      $isLinked := false }} {{ range $memberPage := $memberPages }} {{ if not
      $isLinked }} {{ $lastName := index (last 1 (split $memberPage.Title " "))
      0 }} {{ if strings.Contains (lower $authorName) (lower $lastName) }}
      <a
        href="{{ $memberPage.RelPermalink }}"
        class="font-semibold hover:underline"
        >{{ $authorName }}</a
      >
      {{ $isLinked = true }} {{ end }} {{ end }} {{ end }} {{ if not $isLinked
      }}
      <span>{{ $authorName }}</span>
      {{ end }} {{ if not (eq $index (sub (len $pub.all_authors) 1)) }}, {{ end
      }} {{ end }}
    </p>
  </div>
  {{ end }}

  <hr />

  {{/* PASO 4: Mostrar el resumen (abstract). (Esta parte podría faltar en tu
  archivo) */}} {{ if $pub.abstract }}
  <div class="my-6">
    <h2 class="text-xl font-semibold mb-2">{{ T "abstract" }}</h2>
    <p class="text-justify">{{ $pub.abstract }}</p>
  </div>
  {{ end }} {{/* PASO 5: Mostrar las conexiones (taxonomías). (Esta parte
  también podría faltar) */}}
  <div class="mt-8 pt-4 border-t border-slate-200 dark:border-slate-700">
    <h2 class="text-xl font-semibold mb-3">{{ T "research_context" }}</h2>
    <div class="flex flex-wrap gap-4">
      {{ with $pub.projects }}
      <div>
        <strong>{{ T "projects" }}:</strong>
        {{ range . }} {{ with site.GetPage (printf "projects/%s" .) }}
        <a
          href="{{ .RelPermalink }}"
          class="px-2 py-1 bg-sky-100 text-sky-800 rounded-md text-sm dark:bg-sky-900 dark:text-sky-200 hover:bg-sky-200"
          >{{ .Title }}</a
        >
        {{ end }} {{ end }}
      </div>
      {{ end }} {{ with $pub.areas }}
      <div>
        <strong>{{ T "research_areas" }}:</strong>
        {{ range . }} {{ with site.GetPage (printf "areas/%s" .) }}
        <a
          href="{{ .RelPermalink }}"
          class="px-2 py-1 bg-amber-100 text-amber-800 rounded-md text-sm dark:bg-amber-900 dark:text-amber-200 hover:bg-amber-200"
          >{{ .Title }}</a
        >
        {{ end }} {{ end }}
      </div>
      {{ end }}
    </div>
  </div>

  {{ end }} {{/* Fin del 'if $pub' */}}
</article>
{{ end }}
